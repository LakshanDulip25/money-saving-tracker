<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weekly Money Saving Tracker</title>
  <style>
    /* General Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* Body and Background */
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f9fafb;
      color: #333;
      line-height: 1.6;
      transition: all 0.3s ease;
    }

    /* Header */
    h1 {
      text-align: center;
      font-size: 2rem;
      color: #2c3e50;
      margin: 20px 0;
      animation: fadeIn 1s ease-in-out;
    }

    /* Container */
    .container {
      width: 90%;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .container:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
    }

    /* Form Elements */
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #2c3e50;
    }
    input[type="file"], input[type="number"], input[type="text"] {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }
    input:focus {
      border-color: #4a90e2;
      outline: none;
      box-shadow: 0 0 8px rgba(74, 144, 226, 0.3);
    }

    /* Buttons */
    button {
      width: 100%;
      padding: 12px;
      background-color: #4a90e2;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.3s ease;
    }
    button:hover {
      background-color: #357ab8;
      transform: scale(1.02);
    }
    button.glow {
      background-color: #2ecc71;
      box-shadow: 0 0 10px #2ecc71;
    }
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

    /* Total Section */
    .total {
      margin-top: 20px;
      font-size: 1.2rem;
      color: #2c3e50;
      text-align: center;
    }

    /* History Section */
    .history {
      margin-top: 20px;
    }
    .history-item {
      background: #ffffff;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .history-item:nth-child(even) {
      background: #f0f4f8;
    }
    .history-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }
    .history-item span {
      display: block;
      margin-bottom: 5px;
      color: #2c3e50;
    }
    .history-item a {
      display: inline-block;
      margin-top: 5px;
      color: #4a90e2;
      text-decoration: none;
      font-weight: bold;
      transition: color 0.3s ease;
    }
    .history-item a:hover {
      color: #357ab8;
    }

    /* Dark Mode */
    body.dark-mode {
      background-color: #121212;
      color: #ffffff;
    }
    body.dark-mode h1 {
      color: #bb86fc;
    }
    body.dark-mode .container {
      background: #1e1e1e;
      color: #ffffff;
    }
    body.dark-mode button {
      background-color: #bb86fc;
    }
    body.dark-mode button.glow {
      background-color: #03dac6;
      box-shadow: 0 0 10px #03dac6;
    }
    body.dark-mode .history-item {
      background: #1e1e1e;
      color: #ffffff;
    }
    body.dark-mode .history-item:nth-child(even) {
      background: #2c2c2c;
    }
    body.dark-mode .history-item a {
      color: #bb86fc;
    }

    /* Animations */
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    /* Responsive Design */
    @media (max-width: 600px) {
      h1 {
        font-size: 1.5rem;
      }
      .container {
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <h1>Weekly Money Saving Tracker</h1>
  <div class="container">
    <!-- Dark Mode Toggle Button -->
    <button id="themeToggleBtn">Switch to Dark Mode</button>

    <div class="form-group">
      <label for="uploaderName">Uploader's Name</label>
      <input type="text" id="uploaderName" placeholder="Enter your name">
    </div>
    <div class="form-group">
      <label for="receipt">Upload Deposit Receipt (Images Only)</label>
      <input type="file" id="receipt" accept="image/*">
    </div>
    <div class="form-group">
      <label for="amount">Enter Amount (LKR)</label>
      <input type="number" id="amount" placeholder="Enter amount" min="0">
    </div>
    <button id="submitBtn" disabled>Submit</button>
    <div class="total">
      Total Saved: <span id="totalAmount">LKR 0</span>
    </div>
    <div class="history" id="history">
      <h3>Receipt History</h3>
    </div>
  </div>

  <script>
    const imgbbApiKey = 'c59fd4d2f34bb26b393faaf7affe501f'; // Replace with your ImgBB API key

    let totalSaved = 0;

    // Load data from localStorage on page load
    let data = JSON.parse(localStorage.getItem('savedData')) || [];

    document.getElementById('receipt').addEventListener('change', validateForm);
    document.getElementById('amount').addEventListener('input', validateForm);
    document.getElementById('uploaderName').addEventListener('input', validateForm);

    function validateForm() {
      const receipt = document.getElementById('receipt').files?.[0];
      const amount = document.getElementById('amount').value.trim();
      const uploaderName = document.getElementById('uploaderName').value.trim();
      const submitBtn = document.getElementById('submitBtn');

      if (receipt && amount && uploaderName && isValidImage(receipt)) {
        submitBtn.disabled = false;
        submitBtn.classList.add('glow');
      } else {
        submitBtn.disabled = true;
        submitBtn.classList.remove('glow');
      }
    }

    function isValidImage(file) {
      const allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];
      if (!allowedTypes.includes(file.type)) {
        alert('Please upload a valid image file (JPEG, PNG, GIF).');
        return false;
      }
      return true;
    }

    async function uploadImage(file) {
      const formData = new FormData();
      formData.append('image', file);

      try {
        const response = await fetch(`https://api.imgbb.com/1/upload?key=${imgbbApiKey}`, {
          method: 'POST',
          body: formData,
        });

        if (!response.ok) throw new Error('Failed to upload image');
        const data = await response.json();
        return data.data?.url || '';
      } catch (error) {
        console.error('Error uploading image:', error.message);
        throw error;
      }
    }

    function saveDataLocally(amount, imageUrl, uploaderName) {
      // Add new entry to the local data array
      const timestamp = new Date().toISOString().split('T')[0]; // Save date as YYYY-MM-DD
      const newData = { amount, imageUrl, uploaderName, timestamp };

      // Push the new entry into the global data array
      data.push(newData);

      // Save updated data to localStorage
      localStorage.setItem('savedData', JSON.stringify(data));

      // Optionally, update the UI immediately
      updateTotal(amount);
      addHistoryItem(amount, imageUrl, uploaderName, timestamp);
    }

    function updateTotal(amount) {
      totalSaved += parseFloat(amount);
      document.getElementById('totalAmount').textContent = `LKR ${totalSaved.toFixed(2)}`;
    }

    function addHistoryItem(amount, imageUrl, uploaderName, timestamp) {
      const historyDiv = document.getElementById('history');
      const itemDiv = document.createElement('div');
      itemDiv.className = 'history-item';

      const detailsSpan = document.createElement('span');
      detailsSpan.textContent = `${timestamp} - ${uploaderName} - LKR ${amount}`;

      const link = document.createElement('a');
      link.href = imageUrl; // Set the ImgBB URL as the href
      link.target = '_blank'; // Open in a new tab
      link.textContent = 'View Receipt'; // Text for the link

      itemDiv.appendChild(detailsSpan);
      itemDiv.appendChild(link);
      historyDiv.appendChild(itemDiv);
    }

    document.getElementById('submitBtn').addEventListener('click', async () => {
      const receipt = document.getElementById('receipt').files?.[0];
      const amount = document.getElementById('amount').value.trim();
      const uploaderName = document.getElementById('uploaderName').value.trim();

      try {
        if (!isValidImage(receipt)) return;

        const imageUrl = await uploadImage(receipt); // Get ImgBB URL
        saveDataLocally(amount, imageUrl, uploaderName); // Save locally

        // Clear form fields
        document.getElementById('receipt').value = '';
        document.getElementById('amount').value = '';
        document.getElementById('uploaderName').value = '';
        document.getElementById('submitBtn').disabled = true;
        document.getElementById('submitBtn').classList.remove('glow');
      } catch (error) {
        console.error(error);
        alert('Error: ' + error.message);
      }
    });

    // Load existing data on page load
    window.addEventListener('load', () => {
      try {
        // Initialize total saved amount and history from the local data array
        data.forEach((entry) => {
          updateTotal(entry.amount);
          addHistoryItem(entry.amount, entry.imageUrl, entry.uploaderName, entry.timestamp);
        });
      } catch (error) {
        console.error('Error loading data:', error.message);
      }
    });

    // Dark Mode Toggle
    const themeToggleBtn = document.getElementById('themeToggleBtn');
    let isDarkMode = false;

    themeToggleBtn.addEventListener('click', () => {
      isDarkMode = !isDarkMode;
      document.body.classList.toggle('dark-mode', isDarkMode);
      themeToggleBtn.textContent = isDarkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode';
    });
  </script>
</body>
</html>
